---
title: "PS2_Applied_"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(testthat)
library(dplyr)
library(ggplot2)
library(tidyr)
library(tidycensus)
```



1.1.1
                 
```{r}

# Start the clock!
ptm <- proc.time()

df_parking_tickets <- read.table("parking_tickets_one_percent.txt", sep=",", header=TRUE)

# Stop the clock
proc.time() - ptm

df_parking_tickets
glimpse(df_parking_tickets)
df_parking_tickets%>%head(100)
```
It takes 3.05 to read the file.


```{r}
test_that("Number of parking rows:", {
  nrow(df_parking_tickets)==287458
})
```

1.1.2

The file is 79.8 mb

the full data set is 100 times this data set.
The number of rows is therefore 2,874,580 and the size of the file is 798 mb.

1.1.3



```{r}
na_count <-sapply(df_parking_tickets, function(y) sum(length(which(is.na(y)))))

na_count<-data.frame(na_count)

na_count
```


1.2.1 the number of tickets that were issues in the 1pct file were 287458.  Based on that the number of tickets issued in 2017 were 2,874,580 in Chicago.  The article states that the city of Chicago issues annually more than 3 million tickets.  This is not a significant difference as the article was written early in the year 2018 and exact information may not have been avaialble. 2.8 million is not far away from 3 million anyway.

1.2.2
Most frequent types of violations

```{r}
most_frequent_violations <- df_parking_tickets%>%
  group_by(violation_description)%>%
  summarise(n=n())%>% 
  arrange(desc(n))%>%
  head(20)

most_frequent_violations
ggplot(most_frequent_violations,aes(violation_description,y=n))+
  geom_bar(stat="identity")+
  theme(axis.text=element_text(angle=60, hjust=1, size=6))



```

1.3.1
29 according to 1.1.3




1.3.2



```{r}
df_unit_key <- read.csv("unit_key.csv")

# need to introduce a new variable unit to df_unit_key that is an integer as the previous variable "Reporting.District" is a character variable.
df_unit_key$unit<-as.integer(df_unit_key$"Reporting.District")

df_unit_key

```


there are 385 units

1.3.3


```{r}
df_join<-inner_join(df_parking_tickets, df_unit_key, by="unit")

df_join_na<-
  df_join %>% drop_na(unit)

df_join_na 
```

There are 287458 rows in the orignal table. In the new table there are 287429 rows.  The number of rows that have no units are therefore 29.

1.3.4.

```{r}
df_departments<-
  df_join_na %>%
  group_by(Department.Category) %>%
  summarise(n=n()) %>%
  arrange((desc(n)))

df_departments
```

Chicago police issued 127,078 tickets, Department of Finance issues 106,483 tickets.  Therefore Chicago police issued more tickents

```{r}
df_departments_CPD<-
  df_join_na %>%
  filter(Department.Category=="CPD") %>%
  group_by(unit) %>%
  summarise(n=n()) %>%
  arrange((desc(n)))

df_departments_CPD %>%
  head(5)
```
1.4.1


```{r}
census_api_key("7b144a5d849b2f47475f9c1e44514c692f0246d0")

v17 <- load_variables(2017, "acs5", cache = TRUE)

View(v17)


```


